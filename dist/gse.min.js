"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),gse=function(){function e(e){function c(){e.open=!0,e.root().connected=!0,e.connectCallback(),u(e.root())}function i(){e.open=!1,e.root().connected=!1,l(e.root())}function o(c){if(c.data){var i=void 0;try{if(i=JSON.parse(c.data),!i)return}catch(o){return}var v=e.namespaces.get(i.endpoint);if(v)switch(i.type){case t:u(v);break;case n:l(v);break;case a:h(v,i);break;case r:f(v,i);break;case s:}}}function u(e){e.connected=!0;var t=!0,n=!1,a=void 0;try{for(var r,s=e.cCallbacks[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var c=r.value;c()}}catch(i){n=!0,a=i}finally{try{!t&&s["return"]&&s["return"]()}finally{if(n)throw a}}}function l(e){e.connected=!1;var t=!0,n=!1,a=void 0;try{for(var r,s=e.dCallbacks[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var c=r.value;c()}}catch(i){n=!0,a=i}finally{try{!t&&s["return"]&&s["return"]()}finally{if(n)throw a}}}function h(e,t){var n=e.getEventListeners(t.name);if(n){var a=!0,r=!1,s=void 0;try{for(var c,i=n[Symbol.iterator]();!(a=(c=i.next()).done);a=!0){var o=c.value;o(t.data)}}catch(u){r=!0,s=u}finally{try{!a&&i["return"]&&i["return"]()}finally{if(r)throw s}}}}function f(e,t){var n=e.getAckCallback(t.id);n&&n(t.data)}e.ws.onopen=c,e.ws.onclose=i,e.ws.onmessage=o}var t=0,n=1,a=2,r=3,s=4,c=function(){function e(t){_classCallCheck(this,e),this._url=t,this._ws=null,this._open=!1,this._namespaces=new Map,this._namespaces.set("/",new i(this,"/")),this._nqueue=[],this._squeue=[]}return _createClass(e,[{key:"root",value:function(){return this._namespaces.get("/")}},{key:"connect",value:function(){this._ws=new WebSocket(this.url)}},{key:"createNamespace",value:function(e){var t=this._namespaces.get(e);return t||(t=new i(this,e),this._namespaces.set(e,t),this._open?this._connectNamespace(t):this._nqueue.push(t)),t}},{key:"emit",value:function(e,t,n,s){var c={name:t,data:n,endpoint:e.name};s?(c.id=s,c.type=r):c.type=a;var i=JSON.stringify(c);this._open&&e.connected?this._ws.send(i):this._squeue.push(i)}},{key:"connectCallback",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,r=this._nqueue[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var s=a.value;this._connectNamespace(s)}}catch(c){t=!0,n=c}finally{try{!e&&r["return"]&&r["return"]()}finally{if(t)throw n}}this._nqueue=[];var i=!0,o=!1,u=void 0;try{for(var l,h=this._squeue[Symbol.iterator]();!(i=(l=h.next()).done);i=!0){var f=l.value;this._ws.send(f)}}catch(c){o=!0,u=c}finally{try{!i&&h["return"]&&h["return"]()}finally{if(o)throw u}}this._squeue=[]}},{key:"_connectNamespace",value:function(e){this.ws.send(JSON.stringify({type:t,endpoint:e.name}))}},{key:"url",get:function(){return this._url}},{key:"ws",get:function(){return this._ws}},{key:"open",set:function(e){this._open=e},get:function(){return this._open}},{key:"namespaces",get:function(){return this._namespaces}}]),e}(),i=function(){function e(t,n){_classCallCheck(this,e),this._connection=t,this._name=n,this._connected=!1,this._cCallbacks=[],this._dCallbacks=[],this._eventListeners=new Map,this._ackCallbacks=new Map}return _createClass(e,[{key:"onConnect",value:function(e){this._cCallbacks.push(e)}},{key:"onDisconnect",value:function(e){this._dCallbacks.push(e)}},{key:"listen",value:function(e,t){var n=this._eventListeners.get(e);n||(n=[],this._eventListeners.set(e,n)),n.push(t)}},{key:"emit",value:function(t,n,a){var r=void 0;a&&(r=e.generatedUUID(),this._ackCallbacks.set(r,a)),this._connection.emit(this,t,n,r)}},{key:"getAckCallback",value:function(e){return this._ackCallbacks.get(e)}},{key:"getEventListeners",value:function(e){return this._eventListeners.get(e)}},{key:"connected",get:function(){return this._connected},set:function(e){this._connected=e}},{key:"name",get:function(){return this._name}},{key:"cCallbacks",get:function(){return this._cCallbacks}},{key:"dCallbacks",get:function(){return this._dCallbacks}}],[{key:"generatedUUID",value:function(){return(new Date).getTime()}}]),e}(),o=new Map;return{connect:function(t){if(t.baseUrl){var n=o.get(t.baseUrl);if(n||(n=new c(t.baseUrl),n.connect(),e(n),o.set(t.baseUrl,n)),!t.namespace||"/"===t.namespace)return n.root();var a=o.get(t.namespace);return a?void 0:n.createNamespace(t.namespace)}}}}();